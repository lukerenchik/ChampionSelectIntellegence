<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="../static/favicon.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>League of Legends Match Predictor</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            display: flex;
            justify-content: space-between;
        }
        .team {
            width: 45%;
            border: 1px solid #ccc;
            padding: 10px;
        }
        .team h2 {
            text-align: center;
        }
        .team ul {
            list-style-type: none;
            padding: 0;
        }
        .bans {
            margin-top: 20px;
        }
        .winner {
            text-align: center;
            margin-top: 20px;
        }
        .stats {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .error {
            color: red;
        }
        .success {
            color: green;
        }
        .champ-img {
            width: 50px;  /* Adjust size as necessary */
            height: 50px;
            object-fit: cover;
            margin-right: 10px;
        }
        .champion-entry, .ban-entry {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <!-- Match Display and User Interaction -->
    <div class="container" id="match-section">
        <div class="team" id="blue-team">
            <h2>Blue Team</h2>
            <ul id="blue-champs"></ul>
            <div class="bans">
                <h3>Bans</h3>
                <ul id="blue-bans"></ul>
            </div>
            <div class="winner">
                <button onclick="selectWinner('blue')">Select as Winner</button>
            </div>
        </div>

        <div class="team" id="red-team">
            <h2>Red Team</h2>
            <ul id="red-champs"></ul>
            <div class="bans">
                <h3>Bans</h3>
                <ul id="red-bans"></ul>
            </div>
            <div class="winner">
                <button onclick="selectWinner('red')">Select as Winner</button>
            </div>
        </div>
    </div>

    <!-- User Stats -->
    <div class="stats" id="stats-section">
        <p>Correct Choices: <span id="correct-counter">0</span></p>
        <p>Incorrect Choices: <span id="incorrect-counter">0</span></p>
        <p>Percentage Correct: <span id="percentage-correct">0%</span></p>
    </div>

    <!-- JavaScript -->
    <script>
        let correctCounter = 0;
        let incorrectCounter = 0;

        // Fetch random match data and display in the teams
        async function fetchMatchData() {
            try {
                console.log('Fetching match data...');
                const response = await fetch('/api/rand_match');
                const data = await response.json();

                console.log('Fetched match data:', data);  // Log the fetched data

                // Call displayMatch to populate the actual HTML page
                displayMatch(data);
            } catch (error) {
                console.error('Error fetching match data:', error);
                alert('An error occurred while fetching match data.');
            }
        }

        // Display match data in the main HTML structure
        function displayMatch(data) {
            const blueTeam = document.getElementById('blue-champs');
            const redTeam = document.getElementById('red-champs');
            const blueBans = document.getElementById('blue-bans');
            const redBans = document.getElementById('red-bans');

            // Clear previous entries
            blueTeam.innerHTML = '';
            redTeam.innerHTML = '';
            blueBans.innerHTML = '';
            redBans.innerHTML = '';

            // Iterate through the player data and split into teams
            data.forEach(player => {
                // Create a container for the champion and image
                const li = document.createElement('li');
                const championEntry = document.createElement('div');
                championEntry.classList.add('champion-entry');

                // Create the image element for the champion
                const champImg = document.createElement('img');
                champImg.src = `/static/images/champions/${player.player_champName}.png`;  // Champion image URL
                champImg.alt = player.player_champName;
                champImg.classList.add('champ-img');

                // Create the champion name text
                const champText = document.createElement('span');
                champText.textContent = player.player_champName;

                // Append the image and text to the container
                championEntry.appendChild(champImg);
                championEntry.appendChild(champText);
                li.appendChild(championEntry);

                // Check the team and add player to the corresponding team
                if (player.player_teamId === "blue") {  // Blue team
                    blueTeam.appendChild(li);

                    // Display bans for blue team
                    if (player.player_champName_ban) {
                        const banLi = document.createElement('li');
                        const banEntry = document.createElement('div');
                        banEntry.classList.add('ban-entry');

                        const banImg = document.createElement('img');
                        banImg.src = `/static/images/champions/${player.player_champName_ban}.png`;  // Ban image URL
                        banImg.alt = player.player_champName_ban;
                        banImg.classList.add('champ-img');

                        const banText = document.createElement('span');
                        banText.textContent = player.player_champName_ban;

                        banEntry.appendChild(banImg);
                        banEntry.appendChild(banText);
                        banLi.appendChild(banEntry);

                        blueBans.appendChild(banLi);
                    }
                } else if (player.player_teamId === "red") {  // Red team
                    redTeam.appendChild(li);

                    // Display bans for red team
                    if (player.player_champName_ban) {
                        const banLi = document.createElement('li');
                        const banEntry = document.createElement('div');
                        banEntry.classList.add('ban-entry');

                        const banImg = document.createElement('img');
                        banImg.src = `/static/images/champions/${player.player_champName_ban}.png`;  // Ban image URL
                        banImg.alt = player.player_champName_ban;
                        banImg.classList.add('champ-img');

                        const banText = document.createElement('span');
                        banText.textContent = player.player_champName_ban;

                        banEntry.appendChild(banImg);
                        banEntry.appendChild(banText);
                        banLi.appendChild(banEntry);

                        redBans.appendChild(banLi);
                    }
                }
            });

            // Set the actual winning team for validation later
            const winningPlayer = data.find(player => player.player_win);  // Find a player where player_win is true
            window.actualWinningTeam = winningPlayer.player_teamId === "blue" ? 'blue' : 'red';
        }

        // Handle Winner Selection
        function selectWinner(selectedTeam) {
            const actualWinningTeam = window.actualWinningTeam;

            if (selectedTeam === actualWinningTeam) {
                correctCounter++;
                alert('Correct guess!');
            } else {
                incorrectCounter++;
                alert('Incorrect guess!');
            }

            updateStats();
            fetchMatchData();  // Fetch new match after each guess
        }

        // Update user stats
        function updateStats() {
            document.getElementById('correct-counter').textContent = correctCounter;
            document.getElementById('incorrect-counter').textContent = incorrectCounter;

            const total = correctCounter + incorrectCounter;
            const percentage = total > 0 ? ((correctCounter / total) * 100).toFixed(2) : 0;
            document.getElementById('percentage-correct').textContent = `${percentage}%`;
        }

        // Initialize the page by fetching the first match
        window.onload = function() {
            fetchMatchData();
        };
    </script>
</body>
</html>
